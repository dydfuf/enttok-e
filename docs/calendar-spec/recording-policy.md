# 회의 녹음 정책/스펙

- 작성일: 2025-12-24
- 근거 문서: `docs/calendar-spec/spec.md`

---

## 1) 목표

- 회의 이벤트에서 **명시적 사용자 액션**으로 녹음을 시작한다.
- 녹음 파일을 **로컬에 안전하게 저장**하고, 회의 노트에 참조를 남긴다.
- 프라이버시/권한/오류 처리를 명확히 한다.

---

## 2) 범위

- 데일리 노트 및 캘린더 탭의 이벤트 상세 패널에서 녹음 시작.
- 자동 녹음(이벤트 시작 시 자동)은 제공하지 않는다.

---

## 3) 저장 위치 정책

### 3.1 기본값(권장)
- 기본 저장 경로: `<vault>/.enttokk-e/recordings/YYYY/MM/`
- 파일명: `YYYY-MM-DD_HHMM_[event-title]_[event-id].m4a`

### 3.2 옵션
- 설정에서 저장 위치를 변경 가능(예: `attachments/recordings/`).
- 경로 변경 시 기존 링크는 유지하되, 신규 녹음은 새 경로로 저장.

---

## 4) 파일 형식

- 기본 포맷: MediaRecorder 지원 범위 내에서 `webm` 우선, 가능하면 `m4a`로 저장
- 파일 확장자는 실제 MIME 타입 기준으로 결정

---

## 5) 회의 노트 기록 방식

- 회의 노트에 다음 정보를 기록한다.
  - 이벤트 ID, 캘린더 ID, 시작/종료 시간, 타임존
  - 녹음 파일 경로, 생성 시각, 길이(가능 시)

예시(프론트매터):

```yaml
---
meeting:
  calendar_event_id: "evt_123"
  calendar_id: "cal_abc"
  start_at: "2025-12-24T09:00:00+09:00"
  end_at: "2025-12-24T10:00:00+09:00"
recording:
  path: ".enttokk-e/recordings/2025/12/2025-12-24_0900_team-sync_evt_123.m4a"
  created_at: "2025-12-24T09:05:00+09:00"
  duration_sec: 3200
---
```

---

## 6) 권한/프라이버시

- 최초 녹음 시 마이크 권한을 요청한다.
- 권한 거부 시: 안내 메시지 + 설정 이동 CTA
- 녹음은 **로컬 저장만** 수행(기본값). 외부 업로드는 비활성.

---

## 7) UI/UX 규칙

- 녹음 중 상태 표시(붉은 점 + 타이머)
- 중지 버튼은 항상 접근 가능
- 앱 종료/크래시 시 안전하게 파일을 finalize

---

## 8) 오류 처리

- 디스크 공간 부족: 저장 실패 알림 + 경로 변경 안내
- 장치 오류: 재시도/입력 장치 선택 안내
- 파일 쓰기 실패: 임시 파일 정리 후 재시도
